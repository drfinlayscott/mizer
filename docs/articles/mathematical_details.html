<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mathematical Details behind Mizer • mizer</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Mathematical Details behind Mizer">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mizer</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/mizer.html">Get Started</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/publications.html">Publications</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gustavdelius/mizer">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Mathematical Details behind Mizer</h1>
            
      
      <small class="dont-index"><a href="https://github.com/gustavdelius/mizer/edit/master/vignettes/mathematical_details.Rmd">Edit this page.  </a> Source: <a href="https://github.com/gustavdelius/mizer/blob/master/vignettes/mathematical_details.Rmd"><code>vignettes/mathematical_details.Rmd</code></a></small>
      <div class="hidden name"><code>mathematical_details.Rmd</code></div>

    </div>

    
    
<div id="discrete-approximations-of-integrals" class="section level2">
<h2 class="hasAnchor">
<a href="#discrete-approximations-of-integrals" class="anchor"></a>Discrete Approximations of Integrals</h2>
<div id="grid-points" class="section level3">
<h3 class="hasAnchor">
<a href="#grid-points" class="anchor"></a>Grid Points</h3>
<p>In size spectrum models we wish to keep track of the abundance of fish for a continuum of different weights, however in computer simulations we only keep track of the abundance for weights belonging to a finite set of discrete grid points. The fish grid points <span class="math inline">\(w_{k}\)</span> give the weights at which we track the abundance of fish. In mizer the fish grid points are specified by the following three numbers:</p>
<ol style="list-style-type: decimal">
<li>The number of fish grid points <span class="math inline">\(|w|.\)</span>
</li>
<li>The minimum fish egg size <span class="math inline">\(W_{e}.\)</span>
</li>
<li>The maximum fish size <span class="math inline">\(W_{+}.\)</span>
</li>
</ol>
<p>The vector <span class="math inline">\(w\)</span> has <span class="math inline">\(|w|\)</span> elements, and is such that <span class="math inline">\(w_{1}=W_{e}\)</span> and <span class="math inline">\(w_{|w|}=W_{+}.\)</span> Also the log of <span class="math inline">\(w\)</span> is a vector with a constant difference between successive entries. In other words, <span class="math inline">\(\forall k\in\left\{ 1,..,|w|\right\}\)</span> we have <span class="math inline">\(w_{k}=10^{y_{k}}\)</span> where</p>
<p><span class="math display">\[\begin{equation}
y_{k}=\log_{10}(W_{e})+(k-1) \Delta x.
\end{equation}\]</span></p>
<p>where</p>
<p><span class="math display">\[\begin{equation}
\Delta x = \left(\frac{\log_{10}(W_{+})-\log_{10}(W_{e})}{|w|-1}\right)
\end{equation}\]</span></p>
<p>A vector <span class="math inline">\(\Delta w\)</span> of differences is useful for Riemann sums and PDE schemes. For each <span class="math inline">\(k\in\left\{ 1,..,|w|\right\}\)</span> this is defined so that <span class="math inline">\((\Delta w)_k = (10^{\Delta x} - 1)w_k = w_{k+1}-w_k.\)</span></p>
<!--
as $\left(\Delta w\right)_{k}=w_{k+1}-w_{k}.$ It is most natural
to continue the pattern (that there is a constant ratio between successive
entries of $\Delta w$) to specify $\left(\Delta w\right)_{|w|},$
however, unfortunately the original version of mizer (version 0.3) instead defined
$\left(\Delta w\right)_{|w|}=\left(\Delta w\right)_{|w|-1}.$ 
-->
<p>The plankton grid points <span class="math inline">\(w_{k}^{full}\)</span> consist of the fish grid points together with extra points that refer to smaller weights of plankton, below the fish egg size. In the current version of mizer the plankton grid points are specified by setting the smallest considered plankton size <span class="math inline">\(W_{-}.\)</span> .</p>
<p>In order for our fast Fourier transform to work, the log of plankton grid points must have the same spacing as the log of the <span class="math inline">\(w\)</span> grid points (for fish) described above. Note that this was not so in previous versions of mizer (version 0.3, and before), which did allow a different spacing for the plankton and other grid points.</p>
<p>To define the plankton grid points in mizer we first generate a vector <span class="math inline">\((z_1,..,z_m)\)</span> where <span class="math inline">\(\forall k \in \{ 1,\dots,m \}\)</span> we have <span class="math inline">\(z_k = \log_{10} (W_-) + (k-1) \Delta x,\)</span> where the number of additional plankton grid points <span class="math inline">\(m\)</span> is such that <span class="math inline">\(z_m = \log_{10}(W_e)-\Delta x\)</span> (note that the value of <span class="math inline">\(W_-\)</span> may have to be coerced slightly, so that it lies on a grid point and makes this possible).</p>
<p>The full vector of plankton grid points is then given by the concatenation</p>
<p><span class="math display">\[\begin{equation}
\left(w^{full}_1,..,w^{full}_{|w^{full}|} \right) = \left(10^{z_1},..,10^{z_m},w_1,..,w_{|w|} \right).
\end{equation}\]</span></p>
<p>The number of plankton grid points is hence <span class="math inline">\(|w^{full}| = m + |w|,\)</span> and the spacing between successive plankton grid points is <span class="math inline">\(\Delta w_k ^{full} = (10^{\Delta x} - 1) w^{full} _k.\)</span></p>
<!--

In the current version of mizer the plankton grid points $w^{full}$ are defined such that $\forall k\in\left\{ 1,\dots,|w^{full}|-|w|\right\}$
we have $w_{k}=10^{z_{k}}$ where $z_1 = \log_{10}(W_-),$ and $z_|$

\begin{equation}
z_{k}=\log_{10}(W_{-})+(k-1)\left(\frac{\log_{10}(W_{e}-\left(\Delta w\right)_{0})-\log_{10}(W_{-})}{|w^{full}|-|w|-1}\right),
\end{equation}

and the remaining $|w|$ terms are given by

\begin{equation}
\left(w_{|w^{full}|-|w|+1}^{full},w_{|w^{full}|-|w|+2}^{full},\dots,w_{|w^{full}|}^{full}\right)
=\left(w_{1},w_{2},\dots,w_{|w|}\right).
\end{equation}

This means, if we take the log of $w^{full}$ we get a vector within
which there is a constant spacing between points referring to the
size range of fish, while there is a larger spacing between successive
terms of the vector that refer to weights below that of a fish egg. 

For each $k\in\left\{ 1,\dots,|w^{full}|-1\right\}$ this is defined
as $\left(\Delta w^{full}\right)_{k}=w_{k+1}^{full}-w_{k}^{full}.$
Unfortunately, again, the original version of mizer defined $\left(\Delta w^{full}\right)_{|w^{full}|}$
as being equal to $\left(\Delta w^{full}\right)_{|w^{full}|-1}.$

-->
</div>
<div id="available-energy-integral" class="section level3">
<h3 class="hasAnchor">
<a href="#available-energy-integral" class="anchor"></a>Available Energy Integral</h3>
<p>The available energy to a predator of species <span class="math inline">\(i\in\left\{ 1,..,s\right\}\)</span> and mass <span class="math inline">\(w\in\left[W_{e},W_{+}\right]\)</span> is given by the equation:</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}(w)=\int_{0}^{\infty}\left(N_{R}(w')+\sum_{j=1}^{s}\theta_{ij}N_{j}(w')\right)\Phi_{i}(w'/w)w'dw'
\end{equation}\]</span></p>
<p>Here</p>
<p><span class="math display">\[\begin{equation}
\Phi_{i}(w'/w)=\exp\left[\frac{-\left(\ln(w/(w'\bar{\beta}_{i}))\right)^{2}}{2\sigma_{i}^{2}}\right]
\end{equation}\]</span></p>
<p>describes how much preference a predator of species <span class="math inline">\(i\)</span> and mass <span class="math inline">\(w\)</span> has for a prey with mass <span class="math inline">\(w'.\)</span> We use <span class="math inline">\(w'\)</span> to denote the prey mass.Note we use slightly different notation for <span class="math inline">\(w',\)</span> <span class="math inline">\(\Phi_{i}\)</span> and <span class="math inline">\(\bar{\beta}_{i}\)</span> than the vignette. The <span class="math inline">\(E_{a.i}(w)\)</span> term has to be calculated each time step in order to determine the feeding level:</p>
<p><span class="math display">\[\begin{equation}
f_{i}(w)=\frac{\gamma_{i}w^{q}E_{a.i}(w)}{\gamma_{i}w^{q}E_{a.i}(w)+h_{i}w^{n}}
\end{equation}\]</span></p>
<p>which influences the growth and mortality terms in the McKendrik-von Foerster equation, and must be re-calculated at each time point.</p>
<p>In the original version of mizer, the available energy is calculated as <span class="math inline">\(E_{a.i}(w_{k})=P_{s}[i,k]+P_{b}[i,k]\)</span> where:</p>
<p><span class="math display">\[\begin{equation}
P_{s}[i,k]=\sum_{k'=1}^{\left|w\right|}\Phi_{i}\left(\frac{w_{k'}}{w_{k}}\right)\sum_{j=1}^{s}\theta_{ij}N_{j}(w_{k'})w_{k'}(\Delta w)_{k'}
\end{equation}\]</span></p>
<p>is a left Riemann sum for the available energy from eating other fish and</p>
<p><span class="math display">\[\begin{equation}
P_{b}[i,k]=\sum_{k'=1}^{\left|w^{full}\right|}\Phi_{i}\left(\frac{w_{k'}^{full}}{w_{k}}\right)w_{k'}^{full}N_{R}\left(w_{k'}^{full}\right)(\Delta w{}^{full})_{k'}
\end{equation}\]</span></p>
<p>is a left Riemann sum for the available energy from eating on the plankton spectrum. These terms are calculated in a way that exploits R’s vectorized arithmetic to determine these values for each <span class="math inline">\(i\in\left\{ 1,..,s\right\}\)</span> and <span class="math inline">\(k\in\left\{ 1,..,|w|\right\}\)</span> simultaneously.</p>
<p>We say they are `left’ Riemann sums because the value of the integrand on the left side of each interval is multiplied by the length of that interval, to give the rectangular area contribution for a given interval/size-bin.</p>
</div>
<div id="mortality-integral" class="section level3">
<h3 class="hasAnchor">
<a href="#mortality-integral" class="anchor"></a>Mortality Integral</h3>
<p>The predation mortality rate for a prey of species <span class="math inline">\(i\)</span> and weight <span class="math inline">\(w'\in[W_{e},W_{+}]\)</span> equals</p>
<p><span class="math display">\[\begin{equation}
\mu_{p.i}(w')=\sum_{j=1}^{s}\int_{0}^{\infty}\Phi_{j}(w'/w)(1-f_{j}(w))\gamma_{j}w^{q}\theta_{j,i}N_{j}(w)dw.
\end{equation}\]</span></p>
<p>In the original version of mizer, <span class="math inline">\(\forall i\in\left\{ 1,..,s\right\} ,\)</span> <span class="math inline">\(\forall k'\in\left\{ 1,..,|w|\right\} ,\)</span> this quantity is approximated by the Riemann sum</p>
<p><span class="math display">\[\begin{equation}
\mu_{p.i}(w_{k'})=\sum_{j=1}^{s}\theta_{j,i}\sum_{k=1}^{|w|}\Phi_{j}(w_{k'}/w_{k})(1-f_{j}(w_{k}))\gamma_{j}w_{k}^{q}N_{j}(w_{k})(\Delta w)_{k}
\end{equation}\]</span></p>
</div>
</div>
<div id="spectral-integration-to-speed-up-mizer" class="section level1">
<h1 class="hasAnchor">
<a href="#spectral-integration-to-speed-up-mizer" class="anchor"></a>Spectral Integration To Speed Up Mizer</h1>
<p>Mizer uses a numeric partial differential equation solver to evolve ecosystem models forwards in time.</p>
<p>The partial differential equations include convolution integrals to determine growth and death rates. In the original version of mizer these integrals were performed using Riemann sums, which made the simulations slow. We have substantially increased the speed of mizer by using spectral methods (exploiting the speed of the Fast Fourier Transform) to perform such integrals.</p>
<div id="spectral-integration-for-available-energy" class="section level3">
<h3 class="hasAnchor">
<a href="#spectral-integration-for-available-energy" class="anchor"></a>Spectral Integration For available energy</h3>
<p>Now we shall discuss how we use spectral methods to evaluate the available energy integral:</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}(w)=\int_{0}^{\infty}H_{i}^{*}(w')\Phi_{i}(w'/w)dw',
\end{equation}\]</span></p>
<p>for <span class="math inline">\(i\in\left\{ 1,..,s\right\}\)</span> and <span class="math inline">\(w\in[W_{e},W_{+}],\)</span> where</p>
<p><span class="math display">\[\begin{equation}
H_{i}^{*}(w')=\left(N_{R}(w')+\sum_{j=1}^{s}\theta_{ij}N_{j}(w')\right)w'
\end{equation}\]</span></p>
<p>To begin with let us transform to the log space by defining <span class="math inline">\(x=\ln\left(w/W_{-}\right)\)</span> and <span class="math inline">\(y^{*}=\ln\left(w'/W_{-}\right).\)</span> Our problem hence becomes to evaluate</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}'(x):=E_{a.i}(W_{-}e^{x})=E_{a.i}(w)=\int_{-\infty}^{\infty}H_{i}^{*}(W_{-}e^{y^{*}})W_{-}e^{y^{*}}\Phi_{i}(e^{y^{*}-x}).dy^{*}
\end{equation}\]</span></p>
<p>We need to evaluate <span class="math inline">\(E_{a.i}'(x)\)</span> for each <span class="math inline">\(x\in[X_{e},X_{+}],\)</span> where <span class="math inline">\(X_{e}=\ln\left(W_{e}/W_{-}\right)\)</span> is the egg size in log space, and <span class="math inline">\(X_{+}=\ln\left(W_{+}/W_{-}\right)\)</span> is the maximum fish size in log space. Also note <span class="math inline">\(X_{-}=\ln\left(W_{-}/W_{-}\right)=0\)</span> is the minimum considered plankton size, in the log space. Let <span class="math inline">\(\beta_{i}=\ln(\bar{\beta}_{i}\)</span>), and <span class="math inline">\(\forall v\in\mathbb{R}\)</span> let <span class="math inline">\(H_{i}(v)=H_{i}^{*}(W_{-}e^{v})W_{-}e^{v},\)</span> and let</p>
<p><span class="math display">\[\begin{equation}
\phi_{i}(v):=\Phi_{i}(e^{v})=\exp\left(\frac{-\left(v+\beta_{i}\right)^{2}}{2\sigma_{i}}\right),
\end{equation}\]</span></p>
<p>now we can rewrite our integral as</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}'(x)=\int_{-\infty}^{\infty}H_{i}(y^{*})\phi_{i}(y^{*}-x)dy^{*}.
\end{equation}\]</span></p>
<p>Now we make the substitution <span class="math inline">\(y=x-y^{*}\)</span> and rewrite the integral as</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}'(x)=\int_{-\infty}^{\infty}H_{i}(x-y)\phi_{i}(-y)dy=\int_{-\infty}^{\infty}H_{i}(x-y)\psi_{i}(y)dy,
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\psi_{i}(v):=\phi_{i}(-v),\)</span> <span class="math inline">\(\forall v\in\mathbb{R}.\)</span> The support of a function is the set of its inputs that yield a non-zero output. It is approximately true that <span class="math inline">\(\phi_{i}\)</span> has a support contained in the interval <span class="math inline">\([-\beta_{i}-3\sigma_{i},0],\)</span> and we shall assume that this approximation holds true, so we can rewrite our integral as</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}'(x)=\int_{0}^{\beta_{i}+3\sigma_{i}}H_{i}(x-y)\psi_{i}(y)dy,
\end{equation}\]</span></p>
<p>When we evaluate this integral for <span class="math inline">\(x\in[X_{e},X_{+}],\)</span> we sample <span class="math inline">\(H_{i}(v),\)</span> for each <span class="math inline">\(v=x-y\)</span> in the interval</p>
<p><span class="math display">\[\begin{equation}
[X_{e}-\beta_{i}-3\sigma_{i},X_{+}]\subseteq[X_{-},X_{+}]=[0,X_{+}].
\end{equation}\]</span></p>
<p>Note, we are assuming <span class="math inline">\(X_{-}\leq X_{e}-\beta_{i}-3\sigma_{i}\)</span> holds <span class="math inline">\(\forall i.\)</span></p>
<p>Let us define the period <span class="math inline">\(X_{+}\)</span> functions <span class="math inline">\(\bar{H_{i}}(v)\)</span> and <span class="math inline">\(\bar{\psi_{i}}(v)\)</span> such that when <span class="math inline">\(v\in[0,X_{+}]\)</span> we have <span class="math inline">\(\bar{H_{i}}(v)=H_{i}(v)\)</span> and <span class="math inline">\(\bar{\psi_{i}}(v)\)</span>=<span class="math inline">\(\psi_{i}(v).\)</span></p>
<p>When we are evaluating <span class="math inline">\(E_{a.i}'(x)\)</span> for each <span class="math inline">\(x\in[X_{e},X_{+}],\)</span> we only sample the functions <span class="math inline">\(H_{i}\)</span> and <span class="math inline">\(\psi_{i}\)</span> at points contained in the interval <span class="math inline">\([0,X_{+}],\)</span> and hence we can rewrite our integral as</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}'(x)=\int_{0}^{\beta_{i}+3\sigma_{i}}\bar{H_{i}}(x-y)\bar{\psi_{i}}(y)dy.
\end{equation}\]</span></p>
<p>Now since <span class="math inline">\(\forall y\in[0,X_{+}]\)</span> we have <span class="math inline">\(\bar{\psi_{i}}(y)\neq0\Rightarrow y\in[0,\beta_{i}+3\sigma_{i}],\)</span> we can extend the upper limit of this integral and write</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}'(x)=\int_{0}^{X_{+}}\bar{H_{i}}(x-y)\bar{\psi_{i}}(y)dy.
\end{equation}\]</span></p>
<p>We can approximate this by the Riemann sum</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}'(x_{l})\thickapprox\sum_{k=1}^{^{|w^{full}|}}\bar{H_{i}}(x_{l}-x_{k})\bar{\psi_{i}}(x_{k})\Delta x.
\end{equation}\]</span></p>
<p>Here<span class="math inline">\(\forall k\in\left\{ 1,..,|w^{full}|\right\}\)</span> we let <span class="math inline">\(x_{k}^{full}=\ln(w_{k}^{full}/W_{-}),\)</span> and suppose <span class="math inline">\(\Delta x=x_{2}^{full}-x_{1}^{full}.\)</span> We can evaluate this Riemann sum using spectral integration. We let <span class="math inline">\(\mathbb{F}[u]\)</span> denote that fast Fourier transform of a vector <span class="math inline">\(u\)</span>. We can use fast Fourier transforms to evaluate this integral for all appropriate grid points simultaneously. Let us define</p>
<p><span class="math display">\[\begin{equation}
\left(M_{i}(k)\right)_{k=1}^{|w^{full}|}=\left(\Delta x\right)\mathbb{F}^{-1}\left[\mathbb{F}\left[\left(\bar{H}_{i}(x_{k}^{full}\right)_{k=1}^{|w^{full}|}\right]\times\mathbb{F}\left[\left(\bar{\psi}_{i}(x_{k}^{full}\right)_{k=1}^{|w^{full}|}\right]\right]
\end{equation}\]</span></p>
<p>For <span class="math inline">\(k\in{1,..,|w|}\)</span> this expression gives the same outputs as our Riemann sum. Hence we can extract the appropriate values from <span class="math inline">\(\left(M_{i}(k)\right)_{k=1}^{|w^{full}|}\)</span> by noting that</p>
<p><span class="math display">\[\begin{equation}
\left(E_{a.i}(w_{k})\right)_{k=1}^{|w|}\thickapprox\left(M_{i}(k)\right)_{k=K_{e}}^{|w^{full}|},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(K_{e}=|w^{full}|-|w|+1.\)</span></p>
</div>
<div id="spectral-integration-for-predation-mortality" class="section level3">
<h3 class="hasAnchor">
<a href="#spectral-integration-for-predation-mortality" class="anchor"></a>Spectral integration for predation mortality</h3>
<p>The predation mortality is given by the integral</p>
<p><span class="math display">\[\begin{equation}
\mu_{p.i}(w)=\sum_{j=1}^{s}\theta_{ji}\zeta_{j}^{*}(w),
\end{equation}\]</span></p>
<p>where</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}^{*}(w)=\int_{0}^{\infty}\Phi_{j}(w/w')Q_{j}(w')dw'
\end{equation}\]</span></p>
<p>is the mortality rate of a size <span class="math inline">\(w\)</span> prey from predators of species <span class="math inline">\(j,\)</span> disregarding the interaction matrix. The function <span class="math inline">\(\zeta_{j}^{*}(w)\)</span> is called pred_rate in the code. Since it is also used to compute the predation mortality rate of the plankton, we wish to evaluate <span class="math inline">\(\zeta_{j}^{*}(w),\)</span> for each <span class="math inline">\(w\in[W_{-},W_{+}].\)</span></p>
<p>Making the substitutions <span class="math inline">\(x=\ln(w/W_{-})\)</span> and <span class="math inline">\(y'=\ln(w'/W_{-}),\)</span> we can rewrite this integral as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x):=\zeta_{j}^{*}(w)=\int_{-\infty}^{\infty}\Phi_{j}(e^{x-y'})Q_{j}(W_{-}e^{y'})W_{-}e^{y'}dy'
\end{equation}\]</span></p>
<p>we wish to evaluate <span class="math inline">\(\zeta_{j}(x),\)</span> for each <span class="math inline">\(x\in[X_{-},X_{+}]=[0,X_{+}].\)</span> Here <span class="math inline">\(X_{+}=\ln(W_{+}/W_{-})\)</span> and <span class="math inline">\(X_{-}=\ln(W_{-}/W_{-})=0.\)</span></p>
<p>Letting <span class="math inline">\(\phi_{j}(x-y')=\Phi_{j}(e^{x-y'})\)</span> and <span class="math inline">\(q_{j}(y')=Q_{j}(W_{-}e^{y'})W_{-}e^{y'},\)</span> we can rewrite this integral as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x)=\int_{-\infty}^{\infty}\phi_{j}(x-y')q_{j}(y')dy'
\end{equation}\]</span></p>
<p>Letting <span class="math inline">\(y=x-y'\)</span> we can rewrite this integral as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x)=\int_{-\infty}^{\infty}\phi_{j}(y)q_{j}(x-y)dy,
\end{equation}\]</span></p>
<p>It is approximately true that <span class="math inline">\(\phi_{j}\)</span> has a support contained in the interval <span class="math inline">\([-r_{j},0],\)</span> where <span class="math inline">\(r_{j}:=\beta_{j}+3\sigma_{j}\)</span>. We shall assume that this approximation holds true, so we can rewrite our integral as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x)=\int_{-r_{i}}^{0}\phi_{j}(y)q_{j}(x-y)dy,
\end{equation}\]</span></p>
<p>The period <span class="math inline">\(P\)</span> we shall use for spectral integration is</p>
<p><span class="math display">\[\begin{equation}
P=X_{+}+\max_{j\in\left\{ 1,..,s\right\} }\left(r_{j}\right).
\end{equation}\]</span></p>
<p>Let us define the period <span class="math inline">\(P\)</span> function <span class="math inline">\(\bar{q_{j}}(v)\)</span> such that when <span class="math inline">\(v\in[0,P]\)</span> we have <span class="math inline">\(\bar{q_{j}}(v)=q_{j}(v).\)</span></p>
<p>Let us define the period <span class="math inline">\(P\)</span> function <span class="math inline">\(\bar{\phi_{j}}(v)\)</span> such that when <span class="math inline">\(v\in[-r_{j},P-r_{j}]\)</span> we have <span class="math inline">\(\bar{\phi_{j}}(v)=\phi_{j}(v).\)</span></p>
<p>Now when we evaluate <span class="math inline">\(\zeta_{j}(x)\)</span> for each <span class="math inline">\(x\in[0,X_{+}],\)</span> we only sample the value of <span class="math inline">\(\phi_{j}\)</span> at points contained in the interval <span class="math inline">\([-r_{j},P-r_{j}]\)</span> and we only sample <span class="math inline">\(q_{j}\)</span> at points contained in the interval <span class="math inline">\([0,P].\)</span> At such points our periodic extensions agree with the original functions, and so we can rewrite our integral as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x)=\int_{-r_{i}}^{0}\bar{\phi_{j}}(y)\bar{q_{j}}(x-y)dy,
\end{equation}\]</span></p>
<p>moreover, since <span class="math inline">\(\forall y\in[-r_{j},P-r_{j}]\)</span> we have <span class="math inline">\(\bar{\phi_{j}}(y)\neq0\Rightarrow y\in[-r_{j},0]\)</span> we may extend the upper limit of our integral, and write</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x)=\int_{-r_{j}}^{P-r_{j}}\bar{\phi_{j}}(y)\bar{q_{j}}(x-y)dy.
\end{equation}\]</span></p>
<p>Now since <span class="math inline">\(\bar{\phi_{j}}(y)\bar{q_{j}}(x-y)\)</span> is a period <span class="math inline">\(P\)</span> function in <span class="math inline">\(y,\)</span> we can rewrite it as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x)=\int_{0}^{P}\bar{\phi_{j}}(y)\bar{q_{j}}(x-y)dy.
\end{equation}\]</span></p>
<p><span class="math inline">\(\forall k\in\left\{ 1,..,|w^{full}|\right\}\)</span> let <span class="math inline">\(x_{k}^{full}=\ln(w_{k}^{full}/W_{-}),\)</span> and suppose <span class="math inline">\(\Delta x=x_{2}^{full}-x_{1}^{full}.\)</span> Note that <span class="math inline">\(x_{k}^{full}=(k-1)\Delta x.\)</span> Let us define a longer vector <span class="math inline">\(x^{P}\)</span> with <span class="math inline">\(|x^{P}|=1+(P/\Delta x)\)</span> elements. such that <span class="math inline">\(\forall k\in\left\{ 1,..,|x^{P}|\right\}\)</span> we have <span class="math inline">\(x_{k}^{P}=(k-1)\Delta x\)</span>. Now we can approximate this integral by a Riemann sum, for <span class="math inline">\(l\in{1,..,|w^{^{full}}|},\)</span> by writing</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}(x_{l})\thickapprox\sum_{k=1}^{^{|x^{P}|}}\bar{\phi_{j}}(x_{k})\bar{q_{j}}(x_{l}-x_{k})\Delta x.
\end{equation}\]</span></p>
<p>We let <span class="math inline">\(\mathbb{F}[u]\)</span> denote that fast Fourier transform of a vector <span class="math inline">\(u\)</span>. We can use fast Fourier transforms to evaluate this Riemann sum for all appropriate grid points simultaneously. Now let us define</p>
<p><span class="math display">\[\begin{equation}
\left(L_{j}(k)\right)_{k=1}^{|x^{P}|}=\left(\Delta x\right)\mathbb{F}^{-1}\left[\mathbb{F}\left[\left(\bar{q}_{j}(x_{k}^{P}\right)_{k=1}^{|w^{P}|}\right]\times\mathbb{F}\left[\left(\bar{\phi}_{i}(x_{k}^{P}\right)_{k=1}^{|w^{P}|}\right]\right].
\end{equation}\]</span></p>
<p>Now we have</p>
<p><span class="math display">\[\begin{equation}
\left(\zeta_{j}^{*}(w_{k}^{full})\right)_{k=1}^{|w^{full}|}=\left(\zeta_{j}(x_{k}^{full})\right)_{k=1}^{|w^{full}|}\thickapprox\left(L_{j}(k)\right)_{k=1}^{|w^{full}|},
\end{equation}\]</span></p>
<p>as required.</p>
</div>
<div id="riemann-sum-comparison-for-available-energy" class="section level3">
<h3 class="hasAnchor">
<a href="#riemann-sum-comparison-for-available-energy" class="anchor"></a>Riemann sum comparison for available energy</h3>
<p>The available energy to a predator of species <span class="math inline">\(i\in\left\{ 1,..,s\right\}\)</span> and mass <span class="math inline">\(w\in[W_{e},W_{+}]\)</span> is</p>
<p><span class="math display">\[\begin{equation}
E_{a.i}(w)=\int_{0}^{\infty}H_{i}^{*}(w')\Phi_{i}(w'/w)dw',
\end{equation}\]</span></p>
<p>for <span class="math inline">\(i\in\left\{ 1,..,s\right\}\)</span> and <span class="math inline">\(w\in[W_{e},W_{+}],\)</span> where</p>
<p><span class="math display">\[\begin{equation}
H_{i}^{*}(w')=\left(N_{R}(w')+\sum_{j=1}^{s}\theta_{ij}N_{j}(w')\right)w'
\end{equation}\]</span></p>
<p>is the available biomass of food of mass <span class="math inline">\(w'\)</span> for species <span class="math inline">\(i,\)</span> and</p>
<p><span class="math display">\[\begin{equation}
\Phi_{i}(w'/w)=\exp\left(\frac{-\ln\left(\frac{w}{w'\bar{\beta_{i}}}\right)^{2}}{2\sigma_{i}}\right),
\end{equation}\]</span></p>
<p>measures how much preference predators of weight <span class="math inline">\(w\)</span> and species <span class="math inline">\(i\)</span> have for prey of weight <span class="math inline">\(w'.\)</span> Here <span class="math inline">\(\beta_{i}:=\ln\left(\bar{\beta_{i}}\right).\)</span></p>
<p>In the original version of mizer, if we discount the differences in how the grid points <span class="math inline">\(w^{full},\)</span> <span class="math inline">\(\Delta w\)</span> and <span class="math inline">\(\Delta w^{full}\)</span> are defined then we can write the approximation (i.e., the Riemann sum) that the original version of mizer uses for <span class="math inline">\(E_{a.i}(w_{l})\)</span> as</p>
<p><span class="math display">\[\begin{equation}
E_{i,l}^{^{M}}=\sum_{k=1}^{|w^{full}|}H_{i}^{*}(w_{k})\Phi_{i}(w_{k}/w_{l})\times(\Delta w)_{k},
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\left(\Delta w\right)_{k}=w_{k+1}-w_{k}.\)</span></p>
<p>In our new code we use spectral integration to approximate the available energy, and this corresponds to approximating <span class="math inline">\(E_{a.i}(w_{l})\)</span> by the Riemann sum</p>
<p><span class="math display">\[\begin{equation}
E_{i,l}^{F}=\sum_{k=1}^{|w^{full}|}\bar{H_{i}}(x_{l}-x_{k})\bar{\psi_{i}}(x_{k})\Delta x.
\end{equation}\]</span></p>
<p>Here <span class="math inline">\(\forall k\in\mathbb{Z}\)</span> we have <span class="math inline">\(w_{k}=W_{-}e^{x_{k}}.\)</span> Here <span class="math inline">\(W_{-}\)</span> denotes the minimum considered plankton size, <span class="math inline">\(W_{e}\)</span> denotes the egg size, and <span class="math inline">\(W_{+}\)</span> denotes the maximum possible fish size. Also, note <span class="math inline">\(w_{1}=W_{-},\)</span> and <span class="math inline">\(w_{K_{e}}=W_{e}\)</span> and <span class="math inline">\(w_{|w^{full}|}=W_{+}.\)</span> In the log space we have that <span class="math inline">\(X_{-}=\ln(W_{-}/W_{-})=0\)</span> corresponds to the minimum considered plankton size, <span class="math inline">\(X_{e}=\ln(W_{e}/W_{-})\)</span> corresponds to the fish egg size, and <span class="math inline">\(X_{+}=\ln(W_{+}/W_{-})\)</span> corresponds to the maximum possible fish size.</p>
<p>We shall now use substitutions to transform this sum into a form which we can more easily compare with <span class="math inline">\(E_{i,l}^{^{M}}.\)</span></p>
<p>Suppose <span class="math inline">\(q\)</span> is such that <span class="math inline">\(x_{q}=x_{l}-x_{k},\)</span> now</p>
<p><span class="math display">\[\begin{equation}
x_{l}-x_{k}=(l-1)\Delta x-(k-1)\Delta x=(l-k)\Delta x=(q-1)\Delta x
\end{equation}\]</span></p>
<p>so <span class="math inline">\(q=1+l-k.\)</span> Changing <span class="math inline">\(E_{i,l}^{F}\)</span> into a sum over <span class="math inline">\(q\)</span> instead of <span class="math inline">\(k\)</span> gives us</p>
<p><span class="math display">\[\begin{equation}
E_{i,l}^{F}=\sum_{q=1+l-|w^{full}|}^{^{l}}\bar{H_{i}}(x_{q})\bar{\psi_{i}}(x_{l}-x_{q})\Delta x.
\end{equation}\]</span></p>
<p>In terms of the discrete grid points we are using, the functions <span class="math inline">\(\bar{H_{i}}\)</span> and <span class="math inline">\(\bar{\psi_{i}}\)</span> both have a period of <span class="math inline">\(|w^{full}|.\)</span> It follows that <span class="math inline">\(\bar{H_{i}}(x_{q})\bar{\psi_{i}}(x_{l}-x_{q})\)</span> has a period of <span class="math inline">\(N\)</span> with respect to <span class="math inline">\(q,\)</span> and since our sum is over <span class="math inline">\(N\)</span> successive terms, it follows that if we sum over <span class="math inline">\(N\)</span> other successive terms we will get the same result, and so we can write</p>
<p><span class="math display">\[\begin{equation}
E_{i,l}^{F}=\sum_{q=l}^{|w^{full}|}\bar{H_{i}}(x_{q})\bar{\psi_{i}}(x_{l}-x_{q})\Delta x,
\end{equation}\]</span></p>
<p>here <span class="math inline">\(\forall q\in\left\{ 1,..,|w^{full}|\right\} ,\)</span> we have <span class="math inline">\(\bar{H_{i}}(x_{q})=H_{i}^{*}(w_{q})w_{q}\)</span> so we can write</p>
<p><span class="math display">\[\begin{equation}
E_{i,l}^{F}=\sum_{q=l}^{|w^{full}|}\bar{\psi_{i}}(x_{l}-x_{q})H_{i}^{^{*}}(w_{q})w_{q}\Delta x.
\end{equation}\]</span></p>
<p>Now since <span class="math inline">\(x_{l}\in[X_{e},X_{+}]\)</span> and <span class="math inline">\(x_{q}\in[0,X_{+}]\)</span> we have <span class="math inline">\(x_{l}-x_{q}\in[X_{e}-X_{+},X_{+}].\)</span> There are two possibilities for the type of form <span class="math inline">\(\bar{\psi_{i}}(x_{l}-x_{q})\)</span> takes.</p>
<p>One possibility is that <span class="math inline">\(x_{l}-x_{q}\in[0,X_{+}].\)</span> In this case we have</p>
<p><span class="math display">\[\begin{equation}
\bar{\psi_{i}}(x_{l}-x_{q})=\psi_{i}(x_{l}-x_{q})=\phi_{i}(x_{q}-x_{l})=\Phi_{i}(w_{q}/w_{l}).
\end{equation}\]</span></p>
<p>The other possibility is that <span class="math inline">\(x_{l}-x_{q}\in[X_{e}-X_{+},0).\)</span> In this case we have</p>
<p><span class="math display">\[\begin{equation}
\bar{\psi_{i}}(x_{l}-x_{q})=\psi_{i}(x_{l}-x_{q}+X_{+})
\end{equation}\]</span></p>
<p>where <span class="math inline">\(x_{l}-x_{q}+X_{+}\in[X_{e},X_{+}).\)</span> However, since the support of <span class="math inline">\(\psi_{i}\)</span> is contained in the interval <span class="math inline">\([0,\beta_{i}+3\sigma_{i}],\)</span> where (by assumption) <span class="math inline">\(X_{e}&lt;\beta_{i}+3\sigma_{i},\)</span> we must also have that</p>
<p><span class="math display">\[\begin{equation}
\bar{\psi_{i}}(x_{l}-x_{q})=\psi_{i}(x_{l}-x_{q}+X_{+})=0=\psi_{i}(x_{l}-x_{q})
\end{equation}\]</span></p>
<p>holds in this case.</p>
<p>Hence we have shown that</p>
<p><span class="math display">\[\begin{equation}
\bar{\psi_{i}}(x_{l}-x_{q})=\psi_{i}(x_{l}-x_{q})=\Phi_{i}(w_{q}/w_{l}),\forall x_{l}\in[X_{e},X_{+}],\forall x_{q}\in[0,X_{+}],
\end{equation}\]</span></p>
<p>hence we can write</p>
<p><span class="math display">\[\begin{equation}
E_{i,l}^{F}=\sum_{q=l}^{^{|w^{full}|}}\Phi_{i}(w_{q}/w_{l})H_{i}^{^{*}}(w_{q})w_{q}\Delta x,
\end{equation}\]</span></p>
<p>we can see that this has just the same form as the the original version of mizer Riemann sum <span class="math inline">\(E_{i,l}^{M}\)</span>, except that our rectangles here have width <span class="math inline">\(w_{q}\Delta x,\)</span> unlike in <span class="math inline">\(E_{i,l}^{M}\)</span> where they have width <span class="math inline">\((\Delta w)_{q}.\)</span></p>
</div>
<div id="riemann-sum-comparison-for-predation-mortality" class="section level3">
<h3 class="hasAnchor">
<a href="#riemann-sum-comparison-for-predation-mortality" class="anchor"></a>Riemann sum comparison for predation mortality</h3>
<p>The predation mortality rate of a prey of species <span class="math inline">\(i\)</span> and mass <span class="math inline">\(w\)</span> can be written as</p>
<p><span class="math display">\[\begin{equation}
\mu_{p.i}(w)=\sum_{j=1}^{s}\theta_{j,i}\zeta_{j}^{*}(w)
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\forall i\in\left\{ 1,..,s\right\} ,\)</span> <span class="math inline">\(\forall w\in[0,W_{+}],\)</span> we have that</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j}^{*}(w)=\int_{0}^{\infty}\Phi_{j}(w/w')Q_{j}(w')dw'
\end{equation}\]</span></p>
<p>is the predation rate on prey with mass <span class="math inline">\(w\)</span> from predators of species <span class="math inline">\(j\)</span> when the interaction matrix is discounted (i.e., when we assume the interaction matrix is full of ones). Here <span class="math inline">\(\zeta_{j}^{*}(w)\)</span> is known as pred_rate in the new fft mizer code. Here</p>
<p><span class="math display">\[\begin{equation}
Q_{j}(w')=(1-f_{j}(w'))\gamma_{j}\left(w'\right){}^{^{q^{*}}}N_{j}(w').
\end{equation}\]</span></p>
<p>In the original version of mizer , <span class="math inline">\(\zeta_{j}^{*}(w_{l})\)</span> is essentially approximated by the Riemann sum</p>
<p><span class="math display">\[\begin{equation}
\zeta_{j,l}^{M}=\sum_{k=1}^{^{|w^{full}}|}\Phi_{j}(w_{l}/w_{k})Q_{j}(w_{k})(\Delta w)_{k}.
\end{equation}\]</span></p>
<p>In our new code we use spectral integration to approximate the predation mortality rate, and this corresponds to approximating <span class="math inline">\(\zeta_{j}^{*}(w_{l})\)</span> by the Riemann sum</p>
<p><span class="math display">\[\begin{equation}
\zeta_{i,l}^{F}=\sum_{k=1}^{|x^{P}|}\bar{\phi_{j}}(x_{k})\bar{q_{j}}(x_{l}-x_{k})\Delta x
\end{equation}\]</span></p>
<p>where</p>
<p><span class="math display">\[\begin{equation}
P=x_{|x^{P}|}=(|x^{P}|-1)\Delta x=X_{+}+r
\end{equation}\]</span></p>
<p>where</p>
<p><span class="math display">\[\begin{equation}
r=\max_{i\in\left\{ 1,..,s\right\} }(\beta_{i}+3\sigma_{i}).
\end{equation}\]</span></p>
<p>We shall now use substitutions to transform this sum into a form which we can more easily compare with <span class="math inline">\(\zeta_{j,l}^{M}.\)</span></p>
<p>Suppose <span class="math inline">\(v\)</span> is such that <span class="math inline">\(x_{v}=x_{l}-x_{k},\)</span> now</p>
<p><span class="math display">\[\begin{equation}
x_{l}-x_{k}=(l-1)\Delta x-(k-1)\Delta x=(l-k)\Delta x=(q-1)\Delta x
\end{equation}\]</span></p>
<p>so <span class="math inline">\(v=1+l-k.\)</span> Changing <span class="math inline">\(E_{i,l}^{F}\)</span> into a sum over <span class="math inline">\(v\)</span> instead of <span class="math inline">\(k\)</span> gives us</p>
<p><span class="math display">\[\begin{equation}
\zeta_{i,l}^{F}=\sum_{v=1+l-|x^{P}|}^{l}\bar{\phi_{j}}(x_{l}-x_{v})\bar{q_{j}}(x_{v})\Delta x
\end{equation}\]</span></p>
<p>Now since <span class="math inline">\(\bar{\phi_{j}}(x_{l}-x_{v})\bar{q_{j}}(x_{v})\)</span> is a period <span class="math inline">\(|x^{P}|\)</span> function with respect to <span class="math inline">\(v,\)</span> and <span class="math inline">\(\zeta_{i,l}^{F}\)</span> is a summation involving <span class="math inline">\(|x^{P}|\)</span> successive values of this function, we can rewrite this sum as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{i,l}^{F}=\sum_{v=1}^{|x^{P}|}\bar{\phi_{j}}(x_{l}-x_{v})\bar{q_{j}}(x_{v})\Delta x.
\end{equation}\]</span></p>
<p>For such <span class="math inline">\(v\in\left\{ 1,..,|x^{P}|\right\}\)</span> we have <span class="math inline">\(\bar{q_{j}}(x_{v})=q_{j}(x_{v})=Q_{j}(w_{v})w_{v},\)</span> so we can write</p>
<p><span class="math display">\[\begin{equation}
\zeta_{i,l}^{F}=\sum_{v=1}^{|x^{P}|}\bar{\phi_{j}}(x_{l}-x_{v})q_{j}(w_{v})\Delta x,
\end{equation}\]</span></p>
<p>now since <span class="math inline">\(q_{j}(x_{v})=Q_{j}(w_{v})w_{v}\)</span> and the support of <span class="math inline">\(Q_{j}(w_{v})\)</span> is contained in <span class="math inline">\([W_{-},W_{+}],\)</span> it must be that the support of <span class="math inline">\(q_{j}(x_{v})\)</span> is contained in <span class="math inline">\([0,X_{+}],\)</span> and so we have</p>
<p>where <span class="math inline">\(v\in\left\{ |x^{full}|+1,..,|x^{P}|\right\} \Rightarrow q_{j}(x_{v})=0,\)</span> hence we can rewrite our summation as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{i,l}^{F}=\sum_{v=1}^{|x^{full}|}\bar{\phi_{j}}(x_{l}-x_{v})q_{j}(x_{v})\Delta x.
\end{equation}\]</span></p>
<p>Now since <span class="math inline">\(q_{j}(x_{v})=Q_{j}(w_{v})w_{v}\)</span> in this range, we have</p>
<p><span class="math display">\[\begin{equation}
\zeta_{i,l}^{F}=\sum_{v=1}^{|x^{full}|}\bar{\phi_{j}}(x_{l}-x_{v})Q_{j}(w_{v})w_{v}\Delta x.
\end{equation}\]</span></p>
<p>Now since <span class="math inline">\(x_{l},x_{v}\in[0,X_{+}]\)</span> we must have <span class="math inline">\(x_{l}-x_{v}\in[-X_{+},X_{+}],\)</span> and so we have two possibilities to consider, to understand the form of <span class="math inline">\(\bar{\phi_{j}}(x_{l}-x_{v}).\)</span></p>
<p>The first possibility is that <span class="math inline">\(x_{l}-x_{v}\in[-X_{+},0].\)</span> In this case</p>
<p><span class="math display">\[\begin{equation}
\bar{\phi_{j}}(x_{l}-x_{v})=\phi_{j}(x_{l}-x_{v})=\Phi_{j}(w_{l}/w_{v}).
\end{equation}\]</span></p>
<p>The other possibility is that <span class="math inline">\(x_{l}-x_{v}\in(0,X_{+}].\)</span> In this case</p>
<p><span class="math display">\[\begin{equation}
\bar{\phi_{j}}(x_{l}-x_{v})=\phi_{j}(x_{l}-x_{v}-P),
\end{equation}\]</span></p>
<p>where <span class="math inline">\(x_{l}-x_{v}-P\in(-P,-r]\)</span> since <span class="math inline">\(P=X_{+}+r.\)</span> Now since the support of <span class="math inline">\(\phi_{j}\)</span> is contained in <span class="math inline">\([-r,0],\)</span> with <span class="math inline">\(\phi_{j}(-r)\rightarrow0,\)</span> we have</p>
<p><span class="math display">\[\begin{equation}
\bar{\phi_{j}}(x_{l}-x_{v})=\phi_{j}(x_{l}-x_{v}-P)=0=\phi_{j}(x_{l}-x_{v}),
\end{equation}\]</span></p>
<p>and so we have shown that</p>
<p><span class="math display">\[\begin{equation}
\bar{\phi_{j}}(x_{l}-x_{v})=\phi_{j}(x_{l}-x_{v})=\Phi_{j}(w_{l}/w_{v}),\forall x_{l},x_{v}\in[0,X_{+}].
\end{equation}\]</span></p>
<p>It follows that we can rewrite our summation as</p>
<p><span class="math display">\[\begin{equation}
\zeta_{i,l}^{F}=\sum_{v=1}^{|x^{full}|}\Phi_{j}(w_{l}/w_{v})Q_{j}(w_{v})w_{v}\Delta x.
\end{equation}\]</span></p>
<p>we can see that this has just the same form as the the original version of mizer Riemann sum <span class="math inline">\(\zeta_{i,l}^{M}\)</span>, except that our rectangles here have width <span class="math inline">\(w_{q}\Delta x,\)</span> unlike in <span class="math inline">\(\zeta_{i,l}^{M}\)</span> where they have width <span class="math inline">\((\Delta w)_{q}.\)</span></p>
</div>
</div>
<div id="acknowledgments" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#acknowledgments" class="anchor"></a>Acknowledgments</h1>
<p>Work funded by the European Commissions Horizon 2020 Research and Innovation Programme under Grant Agreement No. 634495 for the project MINOUW (<a href="http://minouw-project.eu/" class="uri">http://minouw-project.eu/</a>).</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#discrete-approximations-of-integrals">Discrete Approximations of Integrals</a><ul class="nav nav-pills nav-stacked">
<li><a href="#grid-points">Grid Points</a></li>
      <li><a href="#available-energy-integral">Available Energy Integral</a></li>
      <li><a href="#mortality-integral">Mortality Integral</a></li>
      </ul>
</li>
      <li>
<a href="#spectral-integration-to-speed-up-mizer">Spectral Integration To Speed Up Mizer</a><ul class="nav nav-pills nav-stacked">
<li><a href="#spectral-integration-for-available-energy">Spectral Integration For available energy</a></li>
      <li><a href="#spectral-integration-for-predation-mortality">Spectral integration for predation mortality</a></li>
      <li><a href="#riemann-sum-comparison-for-available-energy">Riemann sum comparison for available energy</a></li>
      <li><a href="#riemann-sum-comparison-for-predation-mortality">Riemann sum comparison for predation mortality</a></li>
      </ul>
</li>
      <li><a href="#acknowledgments">Acknowledgments</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Finlay Scott, Julia Blanchard, Ken Andersen, Gustav Delius.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'de91577b2f58755afaa137388a513a88',
    indexName: 'mizer',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
